---
name: mongodb-server
packages:
  - mongodb
  - gcc
  - openssl
  - compressors
consumes:
  - name: server
    type: mongodb-server

provides:
  - name: server
    type: mongodb-server

templates:
  helpers/ctl_setup.sh: helpers/ctl_setup.sh
  helpers/ctl_utils.sh: helpers/ctl_utils.sh
  bin/pre-start.erb: bin/pre-start
  bin/mongodb-server_ctl: bin/mongodb_server_ctl
  bin/mongo.sh: bin/mongo.sh
  bin/mongo-ssl.sh: bin/mongo-ssl.sh
  bin/mongoadmin.sh.erb: bin/mongoadmin.sh
  bin/setenv.erb: bin/setenv
  bin/monit_debugger: bin/monit_debugger
  bin/generate_ssl_cert.sh.erb: bin/generate_ssl_cert.sh
  data/properties.sh.erb: data/properties.sh
  config/mongod.conf.erb: config/mongod.conf
  config/mongod_bootstrap.conf.erb: config/mongod_bootstrap.conf
  config/vcap_limits.conf.erb: config/vcap_limits.conf
  ssl/mongodb.pem.erb: ssl/mongodb.pem
  ssl/mongodb.ca.erb: ssl/mongodb.ca
  js/create_admin_user.js.erb: js/create_admin_user.js
  js/initiate_rs.js.erb: js/initiate_rs.js

properties:
  mongodb-server.mongo_DbVersion:
    default: 3.4.6
  mongodb-server.mongo_DbToolVersion:
    default: 1.4.1
  mongodb-server.mongo_SysDriverMongo:
    default: rpm
  mongodb-server.mongo_DbType:
    default: rs
    description: Function of the mongod server - <rs> for replica set only (<cfg> for config server, <sh> for shard server - not implemented yet)
  mongodb-server.mongo_rs_port:
    default: 27017
    description: Default mongodb port for replicasets
  mongodb-server.mongo_cfg_port:
    default: 27019
    description: Default mongodb port for configserver / NOT IMPLEMENTED YET
  mongodb-server.mongo_sh_port:
    default: 27018
    description: Default mongodb port for shards / NOT IMPLEMENTED YET
  mongodb-server.mongo_mongos_port:
    default: 27017
    description: Default mongodb port for mongos / NOT IMPLEMENTED YET
  mongodb-server.mongo_SysReboot:
    default: 1
    description: Authorize the role to restart the server (don't work with a proxy_ssh)
  mongodb-server.mongo_SysIface:
    default: eth0
    description: The interface where the mongodb process should listen on.
  mongodb-server.mongo_SysAliasPrefix:
    default: ""
    description: The mongodb extension name - alias for the interface, ex pre-hostname-prd.domain.name
  mongodb-server.mongo_SysAlias:
    default: "-prd"
    description: The mongodb extension name - alias for the interface, ex pre-hostname-prd.domain.name
  mongodb-server.mongo_SysDomain:
    default: ""
    description: The mongodb extension name - alias for the interface, ex pre-hostname-prd.domain.name
  mongodb-server.mongo_SysLogrotate:
    default: 1
    description: Mongodb logrotate
  mongodb-server.mongo_Conf_engine:
    default: wiredTiger
    description: mongodb storage engine part mmapv1 / wiredTiger / rocksdb
  mongodb-server.mongo_Conf_mmapv1smallFiles:
    default: "false"
    description:
  mongodb-server.mongo_Conf_wiredTiger_cacheSizeGB:
    default: 1
    description: NOT CONFIGURED by default but can be set to minimize the wiredTiger cache
  mongodb-server.mongo_Conf_slowOpThresholdMs:
    default: 100
    description:
  mongodb-server.mongo_Conf_replication:
    default: 1
    description: mongodb replication part
  mongodb-server.mongo_Conf_replSetName:
    default: rs0
    description: replicaset name
  mongodb-server.mongo_Conf_oplogSizeMB:
    default: 256
    description:
  mongodb-server.mongo_Conf_authorization:
    default: 1
    description: mongodb Auth part
  mongodb-server.mongo_DbUserAdminName:
    default: MongoAdmin
    description: mongodb default user
  mongodb-server.mongo_DbUserAdminPwd:
    default: MongoAdmin
    description:
  mongodb-server.mongo_DbRootAdminName:
    default: MongoRoot
    description:
  mongodb-server.mongo_DbRootAdminPwd:
    default: MongoRoot
    description:
  mongodb-server.mongo_DbManagedUsers:
    default:
      #- { name: testUser, password: passw0rd, roles: readWrite, database: app_development }
    description:
  mongodb-server.mongo__operator:
    default: "vcap"
    description:  Mongodb mongod operator
  mongodb-server.mongo__rsconfig:
    default: #mongo__rsconfig: "{{ play_hosts }}"
    description: Mongodb mongod list
  mongodb-server.mongo__state:
    default: "present"
    description: Mongodb mongod state [ 'present', 'absent' ]
  mongodb-server.mongo__backup:
    default: "absent"
    description: Mongodb backup state [ 'present', 'absent' ]
  mongodb-server.mongo_DbCertificate:
    default: "NOT INITIALIZED"
    description: Mongodb certificate for ttl/ssl auth
  mongodb-server.mongo_Conf_ssl:
    default: 1
    description: use tls/ssl for authent and transactions