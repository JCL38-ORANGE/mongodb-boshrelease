---
name: mongodb-server
packages:
  - mongodb
  - gcc
  - openssl
  - compressors
consumes:
  - name: server
    type: mongodb-server

provides:
  - name: server
    type: mongodb-server

templates:
  helpers/ctl_setup.sh: helpers/ctl_setup.sh
  helpers/ctl_utils.sh: helpers/ctl_utils.sh
  bin/pre-start.erb: bin/pre-start
  bin/mongodb-server_ctl: bin/mongodb_server_ctl
  bin/mongo.sh: bin/mongo.sh
  bin/mongo-ssl.sh: bin/mongo-ssl.sh
  bin/mongoadmin.sh.erb: bin/mongoadmin.sh
  bin/setenv.erb: bin/setenv
  bin/monit_debugger: bin/monit_debugger
  bin/generate_ssl_cert.sh.erb: bin/generate_ssl_cert.sh
  data/properties.sh.erb: data/properties.sh
  config/mongod.conf.erb: config/mongod.conf
  config/mongod_bootstrap.conf.erb: config/mongod_bootstrap.conf
  config/vcap_limits.conf.erb: config/vcap_limits.conf
  ssl/mongodb.key.erb: ssl/mongodb.key
  ssl/mongodb.crt.erb: ssl/mongodb.crt
  ssl/mongodb.ca.erb: ssl/mongodb.ca
  js/create_admin_user.js.erb: js/create_admin_user.js
  js/initiate_rs.js.erb: js/initiate_rs.js

properties:
  mongodb-server.Db_Version:
    default: 3.4.6
  mongodb-server.Db_Tool_Version:
    default: 1.4.1
  mongodb-server.Db_Type:
    default: rs
    description: Function of the mongod server - <rs> for replica set only (<cfg> for config server, <sh> for shard server - not implemented yet)
  mongodb-server.rs_port:
    default: 27017
    description: Default mongodb port for replicasets
  mongodb-server.cfg_port:
    default: 27019
    description: Default mongodb port for configserver / NOT IMPLEMENTED YET
  mongodb-server.sh_port:
    default: 27018
    description: Default mongodb port for shards / NOT IMPLEMENTED YET
  mongodb-server.mongos_port:
    default: 27017
    description: Default mongodb port for mongos / NOT IMPLEMENTED YET
  mongodb-server.Sys_Reboot:
    default: 1
    description: Authorize the role to restart the server (don't work with a proxy_ssh)
  mongodb-server.Sys_Logrotate:
    default: 1
    description: Mongodb logrotate
  mongodb-server.Conf_engine:
    default: wiredTiger
    description: mongodb storage engine part mmapv1 / wiredTiger / rocksdb
  mongodb-server.Conf_mmapv1smallFiles:
    default: "false"
    description:
  mongodb-server.Conf_wiredTiger_cacheSizeGB:
    default: 1
    description: NOT CONFIGURED by default but can be set to minimize the wiredTiger cache
  mongodb-server.Conf_slowOpThresholdMs:
    default: 100
    description:
  mongodb-server.Conf_replication:
    default: 1
    description: mongodb replication part
  mongodb-server.Conf_replSetName:
    default: rs0
    description: replicaset name
  mongodb-server.Conf_oplogSizeMB:
    default: 256
    description:
  mongodb-server.Conf_authorization:
    default: 1
    description: mongodb Auth part
  mongodb-server.Db_UserAdminName:
    default: MongoAdmin
    description: mongodb default user
  mongodb-server.Db_UserAdminPwd:
    default: MongoAdmin
    description:
  mongodb-server.Db_RootAdminName:
    default: MongoRoot
    description:
  mongodb-server.Db_RootAdminPwd:
    default: MongoRoot
    description:
  mongodb-server.operator:
    default: "vcap"
    description:  Mongodb mongod operator
  mongodb-server.rs_config:
    default: #mongo__rsconfig: "{{ play_hosts }}"
    description: Mongodb mongod list
  mongodb-server.state:
    default: "present"
    description: Mongodb mongod state [ 'present', 'absent' ]
  mongodb-server.backup:
    default: "absent"
    description: Mongodb backup state [ 'present', 'absent' ]
  mongodb-server.Db_Certificate:
    default:
      ca: "NOT INITIALIZED"
      private_key: "NOT INITIALIZED"
      certificate: "NOT INITIALIZED"
    description: Mongodb certificate for ttl/ssl auth
  mongodb-server.Db_RootCertificate:
    default:
      certificate: "NOT INITIALIZED"
      private_key: "NOT INITIALIZED"
    description: Root certificate for ttl/ssl auth
  mongodb-server.Conf_UseSSL:
    default: 1
    description: use tls/ssl for authent and transactions